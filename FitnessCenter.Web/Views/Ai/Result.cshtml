@model FitnessCenter.Web.Models.ViewModels.AiResultVm
@{
    ViewData["Title"] = "AI Öneri Sonucu";
}

<div class="page-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" 
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                         class="me-2" style="color: var(--fc-success);">
                        <polyline points="9 11 12 14 22 4"/>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    Kişisel Fitness Öneriniz
                </h1>
                <p class="text-muted mb-0">@Model.InputSummary</p>
            </div>
            <div>
                @if (Model.IsCached)
                {
                    <span class="badge-fc badge-fc-info">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" 
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Önbellekten
                    </span>
                }
                @if (!string.IsNullOrEmpty(Model.RecommendationType))
                {
                    <span class="badge-fc badge-fc-primary ms-1">
                        @Model.RecommendationType
                    </span>
                }
            </div>
        </div>
    </div>
</div>

<div class="container pb-5">
    @* ===== AI/Fallback Durum Bildirimi (ÇOK ÖNEMLİ) ===== *@
    @if (Model.IsFallback)
    {
        <div class="alert-fc alert-fc-warning mb-4" style="border-left: 4px solid #f59e0b; background-color: #fffbeb;">
            <div class="d-flex align-items-center gap-3">
                <div class="flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" 
                         stroke="#b45309" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <div>
                    <strong style="color: #b45309; font-size: 1.1rem;">⚠️ AI Erişilemedi - Sistem Otomatik Öneri (Fallback)</strong>
                    <p class="mb-0 mt-1" style="color: #92400e;">
                        AI servisi şu an kullanılamıyor. Aşağıdaki öneriler sistem tarafından otomatik olarak oluşturuldu.
                        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                        {
                            <br/><small>Detay: @Model.ErrorMessage</small>
                        }
                    </p>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert-fc alert-fc-success mb-4" style="border-left: 4px solid #10b981; background-color: #ecfdf5;">
            <div class="d-flex align-items-center gap-3">
                <div class="flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" 
                         stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                </div>
                <div>
                    <strong style="color: #059669; font-size: 1.1rem;">✅ Öneri AI Tarafından Üretildi</strong>
                    <p class="mb-0 mt-1" style="color: #047857;">
                        Bu öneri @(Model.ModelUsed ?? "Gemini AI") modeli tarafından kişiselleştirilmiş olarak oluşturuldu.
                        @if (!string.IsNullOrEmpty(Model.RecommendationType))
                        {
                            <span class="ms-2 badge" style="background-color: #d1fae5; color: #065f46;">@Model.RecommendationType</span>
                        }
                    </p>
                </div>
            </div>
        </div>
    }

    @* Hata durumu *@
    @if (!Model.IsSuccess)
    {
        <div class="alert-fc alert-fc-danger mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" 
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <span>@(Model.ErrorMessage ?? "Bir hata oluştu. Lütfen tekrar deneyin.")</span>
        </div>
    }

    @* Özet Kartı *@
    <div class="row mb-4">
        <div class="col-12">
            <div class="card-fc" style="background: linear-gradient(135deg, var(--fc-primary) 0%, var(--fc-primary-dark) 100%); color: white;">
                <div class="card-body">
                    <div class="d-flex align-items-start gap-3">
                        <div class="p-3 rounded-circle" style="background-color: rgba(255,255,255,0.15);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" 
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 8V4H8"/>
                                <rect width="16" height="12" x="4" y="8" rx="2"/>
                                <path d="M2 14h2"/>
                                <path d="M20 14h2"/>
                                <path d="M15 13v2"/>
                                <path d="M9 13v2"/>
                            </svg>
                        </div>
                        <div>
                            <h4 class="mb-2" style="color: white;">Özet</h4>
                            <p class="mb-0" style="opacity: 0.95; font-size: 1.1rem; line-height: 1.6;">
                                @Model.Summary
                            </p>
                        </div>
                    </div>
                    <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.2);">
                        <small style="opacity: 0.7;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" 
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Oluşturulma: @Model.GeneratedAt.ToLocalTime().ToString("dd MMMM yyyy, HH:mm")
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        @* Antrenman Planı *@
        <div class="col-lg-6">
            <div class="card-fc h-100">
                <div class="card-header d-flex align-items-center gap-2">
                    <span class="p-2 rounded" style="background-color: var(--fc-success-light); color: var(--fc-success);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" 
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6.5 6.5a2.5 2.5 0 0 1 5 0v11a2.5 2.5 0 0 1-5 0v-11z"/>
                            <path d="M17.5 6.5a2.5 2.5 0 0 0-5 0v11a2.5 2.5 0 0 0 5 0v-11z"/>
                            <path d="M4 12h4"/>
                            <path d="M16 12h4"/>
                        </svg>
                    </span>
                    Antrenman Planı
                </div>
                <div class="card-body">
                    @if (Model.WorkoutPlan != null && Model.WorkoutPlan.Any())
                    {
                        <ul class="list-unstyled mb-0">
                            @foreach (var item in Model.WorkoutPlan)
                            {
                                <li class="d-flex align-items-start gap-3 mb-3">
                                    <span class="flex-shrink-0 d-flex align-items-center justify-content-center rounded-circle" 
                                          style="width: 24px; height: 24px; background-color: var(--fc-success-light); color: var(--fc-success);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" 
                                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="20 6 9 17 4 12"/>
                                        </svg>
                                    </span>
                                    <span style="color: var(--fc-gray-700);">@item</span>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted mb-0">Antrenman planı bilgisi bulunamadı.</p>
                    }
                </div>
            </div>
        </div>

        @* Beslenme Önerileri *@
        <div class="col-lg-6">
            <div class="card-fc h-100">
                <div class="card-header d-flex align-items-center gap-2">
                    <span class="p-2 rounded" style="background-color: var(--fc-info-light); color: var(--fc-info);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" 
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2.27 21.7s9.87-3.5 12.73-6.36a4.5 4.5 0 0 0-6.36-6.37C5.77 11.84 2.27 21.7 2.27 21.7zM8.64 14l-2.05-2.04M15.34 15l5.27-5.27"/>
                            <path d="M21 2l-4.47 4.47"/>
                            <path d="M21.25 9.25l-2.5 2.5"/>
                            <path d="M14.5 4.5l-3.5 3.5"/>
                        </svg>
                    </span>
                    Beslenme Önerileri
                </div>
                <div class="card-body">
                    @if (Model.NutritionTips != null && Model.NutritionTips.Any())
                    {
                        <ul class="list-unstyled mb-0">
                            @foreach (var item in Model.NutritionTips)
                            {
                                <li class="d-flex align-items-start gap-3 mb-3">
                                    <span class="flex-shrink-0 d-flex align-items-center justify-content-center rounded-circle" 
                                          style="width: 24px; height: 24px; background-color: var(--fc-info-light); color: var(--fc-info);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" 
                                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="20 6 9 17 4 12"/>
                                        </svg>
                                    </span>
                                    <span style="color: var(--fc-gray-700);">@item</span>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted mb-0">Beslenme önerisi bilgisi bulunamadı.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    @* Uyarılar *@
    @if (Model.Warnings != null && Model.Warnings.Any())
    {
        <div class="row mt-4">
            <div class="col-12">
                <div class="card-fc" style="border-left: 4px solid var(--fc-warning);">
                    <div class="card-header d-flex align-items-center gap-2">
                        <span class="p-2 rounded" style="background-color: var(--fc-warning-light); color: #b45309;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" 
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </span>
                        Dikkat Edilmesi Gerekenler
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-0">
                            @foreach (var item in Model.Warnings)
                            {
                                <li class="d-flex align-items-start gap-3 mb-3">
                                    <span class="flex-shrink-0 d-flex align-items-center justify-content-center rounded-circle" 
                                          style="width: 24px; height: 24px; background-color: var(--fc-warning-light); color: #b45309;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" 
                                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="16" x2="12" y2="12"/>
                                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                                        </svg>
                                    </span>
                                    <span style="color: var(--fc-gray-700);">@item</span>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    }

    @* Aksiyon Butonları *@
    <div class="d-flex justify-content-center gap-3 mt-5">
        <a asp-action="Recommend" class="btn-fc btn-fc-primary btn-fc-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" 
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                <path d="M16 21h5v-5"/>
            </svg>
            Yeni Öneri Al
        </a>
        <a asp-controller="Home" asp-action="Index" class="btn-fc btn-fc-secondary btn-fc-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" 
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            Ana Sayfa
        </a>
    </div>

    @* Bilgilendirme *@
    <div class="text-center mt-5">
        <small style="color: var(--fc-gray-500);">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" 
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
            </svg>
            Bu öneriler genel bilgi amaçlıdır. Herhangi bir sağlık programına başlamadan önce doktorunuza danışın.
        </small>
    </div>
</div>
