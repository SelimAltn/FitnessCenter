@{
    ViewData["Title"] = "Randevu Takvimi";
}

<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
                <h1>
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Randevu Takvimi
                </h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a asp-area="Trainer" asp-controller="Home" asp-action="Index">Eğitmen Paneli</a></li>
                        <li class="breadcrumb-item"><a asp-area="Trainer" asp-controller="Randevu" asp-action="Index">Randevularım</a></li>
                        <li class="breadcrumb-item active">Takvim</li>
                    </ol>
                </nav>
            </div>
            <div class="d-flex gap-2">
                <a asp-action="Index" class="btn-fc btn-fc-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                    Liste Görünümü
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container pb-5">
    <!-- Renk Açıklaması -->
    <div class="mb-4">
        <div class="d-flex gap-4 flex-wrap">
            <div class="d-flex align-items-center gap-2">
                <span class="badge" style="background-color: #10b981; width: 16px; height: 16px; border-radius: 4px;"></span>
                <span class="text-muted small">Onaylandı</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <span class="badge" style="background-color: #f59e0b; width: 16px; height: 16px; border-radius: 4px;"></span>
                <span class="text-muted small">Beklemede</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <span class="badge" style="background-color: #ef4444; width: 16px; height: 16px; border-radius: 4px;"></span>
                <span class="text-muted small">İptal</span>
            </div>
        </div>
    </div>

    <!-- Takvim -->
    <div class="card-fc">
        <div class="card-body p-3 p-md-4">
            <div id="calendar"></div>
        </div>
    </div>
</div>

<!-- Randevu Detay Modal -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalLabel">Randevu Detayı</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <strong>Üye:</strong>
                    <span id="modal-uye"></span>
                </div>
                <div class="mb-3">
                    <strong>Hizmet:</strong>
                    <span id="modal-hizmet"></span>
                </div>
                <div class="mb-3">
                    <strong>Salon:</strong>
                    <span id="modal-salon"></span>
                </div>
                <div class="mb-3">
                    <strong>Tarih / Saat:</strong>
                    <span id="modal-tarih"></span>
                </div>
                <div class="mb-3">
                    <strong>Süre:</strong>
                    <span id="modal-sure"></span>
                </div>
                <div class="mb-3">
                    <strong>Durum:</strong>
                    <span id="modal-durum" class="badge"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-fc btn-fc-secondary" data-bs-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- FullCalendar CDN -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    
    <style>
        /* FullCalendar tema uyumu */
        .fc {
            --fc-border-color: var(--border-color, #e2e8f0);
            --fc-button-bg-color: var(--primary-color, #667eea);
            --fc-button-hover-bg-color: var(--primary-dark, #5a67d8);
            --fc-button-active-bg-color: var(--primary-dark, #5a67d8);
            --fc-today-bg-color: rgba(102, 126, 234, 0.1);
        }
        
        .fc .fc-toolbar-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .fc .fc-button {
            border-radius: 8px;
            font-weight: 500;
            text-transform: capitalize;
        }
        
        .fc .fc-event {
            border-radius: 6px;
            padding: 2px 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        
        .fc .fc-daygrid-day-number {
            font-weight: 500;
        }
        
        /* Mobil uyum */
        @@media (max-width: 768px) {
            .fc .fc-toolbar {
                flex-direction: column;
                gap: 0.5rem;
            }
            .fc .fc-toolbar-title {
                font-size: 1rem;
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            
            var calendar = new FullCalendar.Calendar(calendarEl, {
                locale: 'tr',
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                buttonText: {
                    today: 'Bugün',
                    month: 'Ay',
                    week: 'Hafta',
                    list: 'Liste'
                },
                events: '@Url.Action("CalendarEvents", "Randevu", new { area = "Trainer" })',
                eventClick: function(info) {
                    var event = info.event;
                    var props = event.extendedProps;
                    
                    // Modal içeriğini doldur
                    document.getElementById('modal-uye').textContent = props.uye || '-';
                    document.getElementById('modal-hizmet').textContent = props.hizmet || '-';
                    document.getElementById('modal-salon').textContent = props.salon || '-';
                    document.getElementById('modal-sure').textContent = props.hizmetSure + ' dakika';
                    
                    // Tarih formatla
                    var start = event.start;
                    var end = event.end;
                    var tarihStr = start.toLocaleDateString('tr-TR') + ' ' + 
                                   start.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'}) + ' - ' +
                                   end.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});
                    document.getElementById('modal-tarih').textContent = tarihStr;
                    
                    // Durum badge
                    var durumEl = document.getElementById('modal-durum');
                    durumEl.textContent = props.durum;
                    durumEl.className = 'badge';
                    if (props.durum === 'Onaylandı') {
                        durumEl.style.backgroundColor = '#10b981';
                    } else if (props.durum === 'Beklemede') {
                        durumEl.style.backgroundColor = '#f59e0b';
                    } else {
                        durumEl.style.backgroundColor = '#ef4444';
                    }
                    
                    // Modal'ı aç
                    var modal = new bootstrap.Modal(document.getElementById('eventModal'));
                    modal.show();
                },
                eventDidMount: function(info) {
                    // Tooltip ekle
                    info.el.title = info.event.title + ' - ' + info.event.extendedProps.durum;
                }
            });
            
            calendar.render();
        });
    </script>
}
