@model FitnessCenter.Web.Models.Entities.SupportTicket

@{
    ViewData["Title"] = $"Destek Talebi #{Model.Id}";
}

<div class="page-header">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item"><a asp-action="Index">Destek Kutusu</a></li>
                        <li class="breadcrumb-item active">Talep #@Model.Id</li>
                    </ol>
                </nav>
                <h1>Destek Talebi #@Model.Id</h1>
            </div>
            <div>
                @if (Model.Durum == "Open")
                {
                    <span class="badge-fc badge-fc-warning" style="font-size: 1rem; padding: 0.5rem 1rem;">ðŸ”´ YanÄ±t Bekliyor</span>
                }
                else
                {
                    <span class="badge-fc badge-fc-success" style="font-size: 1rem; padding: 0.5rem 1rem;">âœ… YanÄ±tlandÄ±</span>
                }
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert-fc alert-fc-danger mb-4">@TempData["ErrorMessage"]</div>
    }

    <div class="row">
        <!-- Sol: Talep DetayÄ± -->
        <div class="col-lg-6 mb-4">
            <div class="card-fc h-100">
                <div class="card-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    KullanÄ±cÄ± MesajÄ±
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block">GÃ¶nderen</small>
                        <strong>@(Model.KullaniciAdi ?? Model.User?.UserName ?? "Bilinmiyor")</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">E-posta</small>
                        <a href="mailto:@Model.Email">@Model.Email</a>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Konu</small>
                        <strong>@Model.Konu</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Tarih</small>
                        @Model.OlusturulmaTarihi.ToString("dd MMMM yyyy HH:mm")
                    </div>
                    <hr />
                    <div>
                        <small class="text-muted d-block mb-2">Mesaj</small>
                        <p style="white-space: pre-wrap; background: var(--fc-gray-50); padding: 1rem; border-radius: var(--fc-radius-md);">@Model.Mesaj</p>
                    </div>

                    <!-- Mail durumu -->
                    <div class="mt-3 pt-3 border-top">
                        <small class="text-muted">
                            @if (Model.AdminMailGonderildi)
                            {
                                <span class="text-success">âœ“ Bu talep size email olarak iletildi</span>
                            }
                            else
                            {
                                <span class="text-warning">âš  Email gÃ¶nderilemedi (SMTP ayarlarÄ± kontrol edin)</span>
                            }
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- SaÄŸ: Admin YanÄ±tÄ± -->
        <div class="col-lg-6 mb-4">
            @if (Model.Durum == "Closed" && !string.IsNullOrEmpty(Model.AdminCevap))
            {
                <!-- YanÄ±tlanmÄ±ÅŸ - Salt okunur -->
                <div class="card-fc h-100" style="border-color: var(--fc-success);">
                    <div class="card-header" style="background: var(--fc-success-light); color: #065f46;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Admin YanÄ±tÄ± (GÃ¶nderildi)
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <small class="text-muted d-block">YanÄ±t Tarihi</small>
                            @Model.CevapTarihi?.ToString("dd MMMM yyyy HH:mm")
                        </div>
                        <hr />
                        <p style="white-space: pre-wrap; background: var(--fc-success-light); padding: 1rem; border-radius: var(--fc-radius-md);">@Model.AdminCevap</p>
                        
                        <div class="mt-3">
                            <small class="text-muted">
                                @if (Model.KullaniciMailGonderildi)
                                {
                                    <span class="text-success">âœ“ YanÄ±t kullanÄ±cÄ±ya email olarak gÃ¶nderildi</span>
                                }
                                else
                                {
                                    <span class="text-warning">âš  Email gÃ¶nderilemedi (kullanÄ±cÄ± siteden gÃ¶rebilir)</span>
                                }
                            </small>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <!-- YanÄ±tlanmamÄ±ÅŸ - Form gÃ¶ster -->
                <div class="card-fc h-100">
                    <div class="card-header" style="background: var(--fc-warning-light); color: #92400e;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                            <path d="M12 20h9"/>
                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                        </svg>
                        YanÄ±t Yaz
                    </div>
                    <div class="card-body">
                        <form asp-action="Reply" method="post">
                            <input type="hidden" name="TicketId" value="@Model.Id" />
                            
                            <div class="form-fc-group">
                                <label class="form-fc-label">YanÄ±tÄ±nÄ±z</label>
                                <textarea name="AdminCevap" class="form-fc-control" rows="8" 
                                    placeholder="KullanÄ±cÄ±ya gÃ¶ndermek istediÄŸiniz yanÄ±tÄ± buraya yazÄ±n..." required></textarea>
                                <span class="form-fc-hint">Bu yanÄ±t kullanÄ±cÄ±nÄ±n email adresine gÃ¶nderilecek ve site iÃ§inden gÃ¶rÃ¼ntÃ¼lenebilecek.</span>
                            </div>

                            <div class="d-flex gap-3">
                                <button type="submit" class="btn-fc btn-fc-success btn-fc-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="22" y1="2" x2="11" y2="13"/>
                                        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                    </svg>
                                    YanÄ±tla ve Kapat
                                </button>
                                <a asp-action="Index" class="btn-fc btn-fc-secondary btn-fc-lg">Geri DÃ¶n</a>
                            </div>
                        </form>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Silme butonu -->
    <div class="mt-4">
        <form asp-action="Delete" asp-route-id="@Model.Id" method="post" 
            onsubmit="return confirm('Bu destek talebini silmek istediÄŸinizden emin misiniz?');">
            <button type="submit" class="btn-fc btn-fc-danger btn-fc-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 6h18"/>
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                </svg>
                Talebi Sil
            </button>
        </form>
    </div>
</div>
