@model IEnumerable<FitnessCenter.Web.Models.Entities.Randevu>

@{
    ViewData["Title"] = "Randevular";
}

<h2>Randevular</h2>
<hr />

<!-- Bilgi / hata mesajları -->
@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if (TempData["Info"] != null)
{
    <div class="alert alert-info">@TempData["Info"]</div>
}

<!-- FİLTRE BLOĞU -->
<section style="margin-bottom:1rem; padding:0.75rem; border:1px solid #ddd; border-radius:4px;">
    <h4 style="margin-top:0;">Filtreler</h4>

    <form asp-action="Index" method="get">
        <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:flex-end;">

            <div>
                <label for="tarih">Tarih</label><br />
                <input type="date"
                       id="tarih"
                       name="tarih"
                       value="@(ViewData["SeciliTarih"] as string)"
                       style="min-width:150px;" />
            </div>

            <div>
                <label for="salonId">Salon</label><br />
                <select id="salonId"
                        name="salonId"
                        asp-items="@(ViewData["SalonId"] as SelectList)"
                        style="min-width:150px;">
                    <option value="">Tümü</option>
                </select>
            </div>

            <div>
                <label for="egitmenId">Eğitmen</label><br />
                <select id="egitmenId"
                        name="egitmenId"
                        asp-items="@(ViewData["EgitmenId"] as SelectList)"
                        style="min-width:170px;">
                    <option value="">Tümü</option>
                </select>
            </div>

            <div>
                <label for="uyeId">Üye</label><br />
                <select id="uyeId"
                        name="uyeId"
                        asp-items="@(ViewData["UyeId"] as SelectList)"
                        style="min-width:170px;">
                    <option value="">Tümü</option>
                </select>
            </div>

            <div>
                <label for="durum">Durum</label><br />
                <select id="durum"
                        name="durum"
                        asp-items="@(ViewData["Durum"] as SelectList)"
                        style="min-width:130px;">
                    <option value="">Tümü</option>
                </select>
            </div>

            <div>
                <button type="submit">Filtrele</button>
                <a asp-action="Index" style="margin-left:0.5rem;">Temizle</a>
            </div>
        </div>
    </form>
</section>

<!-- LİSTE -->
@if (!Model.Any())
{
    <div class="alert alert-info">
        Henüz sistemde randevu bulunmuyor.
    </div>
}
else
{
    <table class="table" style="width:100%; border-collapse:collapse;">
        <thead>
            <tr style="border-bottom:1px solid #ccc;">
                <th style="padding:0.4rem;">Tarih</th>
                <th style="padding:0.4rem;">Saat</th>
                <th style="padding:0.4rem;">Salon</th>
                <th style="padding:0.4rem;">Hizmet</th>
                <th style="padding:0.4rem;">Eğitmen</th>
                <th style="padding:0.4rem;">Üye</th>
                <th style="padding:0.4rem;">Durum</th>
                <th style="padding:0.4rem; width:210px;">İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:0.4rem;">
                        @item.BaslangicZamani.ToString("dd.MM.yyyy")
                    </td>
                    <td style="padding:0.4rem;">
                        @item.BaslangicZamani.ToString("HH:mm")
                        -
                        @item.BitisZamani.ToString("HH:mm")
                    </td>
                    <td style="padding:0.4rem;">@item.Salon?.Ad</td>
                    <td style="padding:0.4rem;">@item.Hizmet?.Ad</td>
                    <td style="padding:0.4rem;">@item.Egitmen?.AdSoyad</td>
                    <td style="padding:0.4rem;">@item.Uye?.AdSoyad</td>

                    <td style="padding:0.4rem;">
                        @if (item.Durum == "Onaylandı")
                        {
                            <span style="color:#0a7c20; font-weight:bold;">Onaylandı</span>
                        }
                        else if (item.Durum == "İptal")
                        {
                            <span style="color:#b30000; font-weight:bold;">İptal</span>
                        }
                        else
                        {
                            <span style="color:#a66b00; font-weight:bold;">Beklemede</span>
                        }
                    </td>

                    <td style="padding:0.4rem;">
                        <a asp-action="Details"
                           asp-route-id="@item.Id"
                           style="margin-right:0.5rem;">
                            Detay
                        </a>

                        <form asp-action="DurumDegistir"
                              method="post"
                              style="display:inline;">
                            <input type="hidden" name="id" value="@item.Id" />
                            <input type="hidden" name="yeniDurum" value="Onaylandı" />
                            <button type="submit"
                                    @(item.Durum == "Onaylandı" ? "disabled" : "")
                                    style="margin-right:0.3rem;">
                                Onayla
                            </button>
                        </form>

                        <form asp-action="DurumDegistir"
                              method="post"
                              style="display:inline;">
                            <input type="hidden" name="id" value="@item.Id" />
                            <input type="hidden" name="yeniDurum" value="İptal" />
                            <button type="submit"
                                    @(item.Durum == "İptal" ? "disabled" : "")>
                                İptal Et
                            </button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
